<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰¾å‡ºé›·å†›çš„å¹¿å‘Šå°å­—</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    user-select: none;
  }
  canvas {
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    cursor: pointer;
  }
  #message, #timer, #loading {
    position: fixed;
    width: 100%;
    text-align: center;
    font-weight: bold;
    text-shadow: 0 0 8px #fff;
  }
  #message { top: 20px; color: #ff6700; font-size: 20px; }
  #timer { top: 50px; color: #ffffff; font-size: 18px; }
  #loading { top: 50%; transform: translateY(-50%); color: #fff; font-size: 20px; }
  #dialog {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: white; border-radius: 12px; padding: 20px;
    box-shadow: 0 0 30px rgba(0,0,0,0.4); display: none; text-align: center; z-index: 10;
  }
  #dialog button {
    margin: 10px; padding: 8px 16px; border: none; border-radius: 8px;
    font-size: 16px; cursor: pointer;
  }
  #dialog button:first-child { background-color: #ff6700; color: #fff; }
  #dialog button:last-child { background-color: #ccc; }
  #adSlot {
    position: fixed; bottom: 20px; right: 20px;
    width: 120px; height: 60px; background: rgba(255,255,255,0.9);
    border-radius: 8px; text-align: center; line-height: 60px;
    font-weight: bold; color: #ff6700; cursor: pointer; display: none;
  }
  #adSlot img { width: 120px; height: 60px; border-radius: 8px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="380" height="600"></canvas>
<div id="message"></div>
<div id="timer"></div>
<div id="loading">åŠ è½½ä¸­...</div>
<div id="dialog">
  <p id="dialogText">æ—¶é—´åˆ°ï¼æ˜¯å¦ç»§ç»­ï¼Ÿ</p>
  <button id="btnContinue">ç»§ç»­</button>
  <button id="btnQuit">ç»“æŸ</button>
</div>
<div id="adSlot">å¹¿å‘Šä½</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const msg = document.getElementById('message');
const timerDisplay = document.getElementById('timer');
const loading = document.getElementById('loading');
const dialog = document.getElementById('dialog');
const btnContinue = document.getElementById('btnContinue');
const btnQuit = document.getElementById('btnQuit');
const dialogText = document.getElementById('dialogText');
const adSlot = document.getElementById('adSlot');

const levels = [
  { big: "æˆ‘å„¿å­æ˜¯é›·å†›", small: "çš„ç²‰ä¸", bg: "https://picsum.photos/380/600?blur=2", diff: 1 },
  { big: "é€†å…‰ä¹‹ç‹", small: "æ˜¯æˆ‘å®¶ç¯æ³¡", bg: "https://picsum.photos/380/600?grayscale", diff: 2 },
  { big: "å…¨çƒæœ€å¼ºAI", small: "æ¨¡å‹çˆ±å‘å‘†", bg: "https://picsum.photos/380/600?blur=5", diff: 3 },
  { big: "æˆ‘ä¹°äº†å°ç±³SU7", small: "çš„æµ·æŠ¥", bg: "https://picsum.photos/380/600?random=4", diff: 4 }
];

let currentLevel = 0;
let targetArea = {};
let bgImage = new Image();
let countdown = 10;
let timer;
let found = false;
let score = 0;
let gameActive = true; // æ¸¸æˆè¿›è¡ŒçŠ¶æ€

function showMessage(text){
  msg.textContent = text;
  msg.style.opacity = 1;
  setTimeout(()=>msg.style.opacity=0,1000);
}

function updateTimer(){ timerDisplay.textContent = `â±ï¸ ${countdown} ç§’`; }

function drawLevel(){
  found=false;
  dialog.style.display="none";
  clearInterval(timer);
  loading.style.display="block";
  gameActive=true;
  adSlot.style.display="block";

  const level=levels[currentLevel];
  bgImage.src=level.bg;
  bgImage.onload=()=>{
    loading.style.display="none";
    ctx.filter='blur(1px) brightness(0.9)';
    ctx.drawImage(bgImage,0,0,canvas.width,canvas.height);
    ctx.filter='none';

    // å¤§å­—
    ctx.fillStyle="#000";
    ctx.font="bold 30px 'PingFang SC'";
    ctx.textAlign="center";
    const bigY=canvas.height/2-100;
    ctx.fillText(level.big,canvas.width/2,bigY);

    // å°å­—
    const diff=level.diff;
    const size=16-diff;
    const rotate=(Math.random()*10-5)*Math.PI/180;
    const color=diff>=3?`rgba(255,255,255,${0.3+Math.random()*0.2})`:`rgba(50,50,50,${0.5+Math.random()*0.2})`;
    const x=canvas.width/2+40+Math.random()*60;
    const y=bigY+50+Math.random()*40;

    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rotate);
    ctx.globalAlpha=Math.max(0.3,0.6-diff*0.05);
    ctx.fillStyle=color;
    ctx.shadowColor="rgba(0,0,0,0.3)";
    ctx.shadowBlur=2;
    ctx.shadowOffsetX=1;
    ctx.shadowOffsetY=1;
    ctx.font=`${size}px 'PingFang SC'`;
    ctx.fillText(level.small,0,0);
    ctx.restore();

    targetArea={x:x-30,y:y-20,w:100,h:40};

    // å€’è®¡æ—¶
    countdown=10;
    updateTimer();
    timer=setInterval(()=>{
      countdown--;
      updateTimer();
      if(countdown<=0){
        clearInterval(timer);
        if(!found){
          showMessage("âŒ› æ—¶é—´åˆ°ï¼");
          highlightTarget(()=>{
            dialogText.textContent="æ—¶é—´åˆ°ï¼æ˜¯å¦ç»§ç»­ï¼Ÿ";
            dialog.style.display="block";
          });
        }
      }
    },1000);
  };
}

canvas.addEventListener('click',(e)=>{
  if(!gameActive || dialog.style.display==="block") return;
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;

  if(x>targetArea.x && x<targetArea.x+targetArea.w && y>targetArea.y && y<targetArea.y+targetArea.h){
    found=true;
    score++;
    clearInterval(timer);
    showMessage("âœ… æ‰¾åˆ°äº†ï¼");
    setTimeout(()=>nextLevel(),1000);
  } else showMessage("âŒ æ²¡æ‰¾åˆ°ï¼");
});

function highlightTarget(callback){
  let flashes=0;
  const interval=setInterval(()=>{
    flashes++;
    ctx.strokeStyle=flashes%2===0?"rgba(255,0,0,0)":"rgba(255,0,0,0.8)";
    ctx.lineWidth=3;
    ctx.strokeRect(targetArea.x,targetArea.y,targetArea.w,targetArea.h);
    if(flashes>=6){
      clearInterval(interval);
      callback();
    }
  },300);
}

btnContinue.addEventListener('click',()=>{ dialog.style.display="none"; nextLevel(); });
btnQuit.addEventListener('click',()=>{ dialog.style.display="none"; endGame(); });

function nextLevel(){
  currentLevel++;
  if(currentLevel<levels.length) drawLevel();
  else endGame();
}

function endGame(){
  clearInterval(timer);
  timerDisplay.textContent="";
  gameActive=false;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ç™½åº•
  ctx.fillStyle="rgba(255,255,255,0.9)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#000";
  ctx.font="bold 22px 'PingFang SC'";
  ctx.textAlign="center";

  const total=levels.length;
  const percent=Math.round((score/total)*100);
  let title="ğŸ‘€ ä½ çš„å¹¿å‘Šæ•æ„Ÿåº¦ç­‰çº§ï¼š";
  let comment="";
  if(percent===100) comment="å¹¿å‘Šæ³•é¡¾é—®";
  else if(percent>=75) comment="ç»†èŠ‚è§‚å¯Ÿå¤§å¸ˆ";
  else if(percent>=50) comment="åˆæ ¼çš„åƒç“œç¾¤ä¼—";
  else comment="ä½ å¯èƒ½çœŸä¿¡äº†å¹¿å‘Š ğŸ˜…";

  ctx.fillText("ğŸ‰ æ¸¸æˆç»“æŸ",canvas.width/2,canvas.height/2-50);
  ctx.fillText(`æˆåŠŸæ‰¾åˆ° ${score} / ${total}`,canvas.width/2,canvas.height/2-10);
  ctx.fillText(`æˆåŠŸç‡ï¼š${percent}%`,canvas.width/2,canvas.height/2+20);
  ctx.fillText(title+comment,canvas.width/2,canvas.height/2+60);

  // ç»“ç®—é¡µå¹¿å‘Š
  adSlot.style.display="block";
  adSlot.innerHTML="<img src='https://picsum.photos/120/60?random=5' alt='å¹¿å‘Š'>";
  adSlot.onclick=()=>window.open('https://ä½ çš„å¹¿å‘Šé“¾æ¥.com','_blank');
}

drawLevel();
</script>
</body>
</html>
